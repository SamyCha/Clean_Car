<div class="container">
  <div class="row text-right margin-top5" >
    <div class="col-xs-10 col-xs-offset-2">
      <h1 id="dashboard-h1">Your Profile</h1>
    </div>
  </div>

  <section id="cleaner-section">
    <div class="row">
      <div class="col-xs-12 profil-description flex-ver-center">
        <div class="col-xs-5 text-center cleaner-picture">
          <% if @user.avatar? %>
            <%= cl_image_tag @user.avatar.path, crop: :fill  %>
          <% else %>
            <%= image_tag "profil.png" %>
          <% end %>
        </div>
        <div class="col-xs-7 text-right cleaner-details">
          <p class="name"><%= @user.firstname.capitalize %> <%= @user.lastname.capitalize %></p>
          <p class="address"><%= @user.address %></p>
          <p class="email"><%= @user.email %></p>
          <p class="created-at">cleaner since : <%= @user.created_at.strftime('%d/ %m/ %Y') %></p>
        </div>
      </div>
      <div class="col-xs-12 text-right">
        <%= link_to "edit", pro_dashboard_edit_path(@user), id: "cleaner-edit" %>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-12">
        <h2>Your Missions : </h2>
        <ul class="dashboard-cleaner-ul" id="cleaning-recap">
          <%= render partial: "shared/card_cleaning_for_cleaner_dashboard", locals: { missions: @missions } %>
        </ul>
      </div>

      <% unless @completes.blank? %>
        <div class="col-xs-12">
          <h2>Past Missions :</h2>
          <ul class="dashboard-cleaner-ul">
            <% @completes.each do |cleaning| %>
              <p class="created-at">created : <%= cleaning.created_at.strftime("%d/%m/%y at %Hh%M") %></p>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </section>

  <div class="socket-field"></div>

</div>

<%= content_for :after_js do %>
  <script>
    $(document).ready(function() {
      $("#accept-btn").on('click', function(e) {
        $(".dashboard-cleaning-link").toggleClass('hidden');
      });
    });
  </script>
  <script>
    App.cable.subscriptions.create("PaidChannel",
      {
        received: (data) => {
          if (data.current_user_id == <%= current_user.id %>) {
            $('#cleaning-recap').html(data.paid_partial);
          }
        }
      }
    )
  </script>
<% end %>
